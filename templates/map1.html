{% extends "zero.html" %}
{% block script %}
<!--<script async src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=console.debug&libraries=maps,marker&v=beta">
</script>-->
<script>
    let map, infoWindow;

    function getUserLocation() {
        return new Promise((resolve, reject) => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                        };
                        resolve(userLocation);
                    },
                    (error) => {
                        reject(error);
                    },
                );
            } else {
                reject(new Error("Geolocation is not supported by this browser."));
            }
        });
    }

    async function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
            zoom: 15,
        });
        infoWindow = new google.maps.InfoWindow();

        try {
            const userLocation = await getUserLocation();
            infoWindow.setPosition(userLocation);
            infoWindow.setContent("Location found.");
            infoWindow.open(map);
            map.setCenter(userLocation);
        } catch (error) {
            handleLocationError(true, infoWindow, map.getCenter());
        }
    }

    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(
            browserHasGeolocation
                ? "Error: The Geolocation service failed."
                : "Error: Your browser doesn't support geolocation.",
        );
        infoWindow.open(map);
    }

    window.initMap = initMap;
</script>

<script defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVaeNch_aeLuTOIVX75orHHF0z7eeGlJI&callback=initMap&v=weekly"></script>
{% endblock %}
{% block title %} Map {% endblock %}
{% block content %}
<section class="">
    <div class="p-6">
        <p class="text-5xl">Bird Watching Spots Near You</p>
        <div class="w-full h-[35rem] bg-gray-700 mt-8 mb-5 rounded-md drop-shadow" id="map">
        </div>
        <p class="text-2xl"> Your Current Location: {{user_location.lat}}, {{user_location.lng}}</br>Number of bird
            watching spots: {{birding_area|length}}</p>
    </div>
</section>
{% endblock %}
